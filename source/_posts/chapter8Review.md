---
title: 微机复习第八章
date: 2018-1-4 16:00:00
categories: review
tags: microcomputer
---
# 微型计算机接口

## Chapter 8
本章的主要内容是中断

### 中断基本概念
CPU暂停当前执行的程序，转而执行服务程序，执行完成后继续执行被暂停主程序 叫做中断  
<!--more-->
##### 中断类型码
范围0～255，前32个DOS保留  
##### 中断向量
中断服务子程序的地址  
共有4个字节，低位两字节保存子程序段内偏移地址，高位两字节保存子程序的段基址  
##### 中断向量表
地址空间的最低1KB空间保存256个中断向量，每个中断向量占有4字节  

> 中断类型码 **n** 与中断向量表位置关系：  
>   4 × n + 0 ~ 4 × n + 3  

##### 中断向量的读写
1. 程序员手动设置  
2. DOS 21H 子功能
    * 读  
        入口参数：AH=35H，AL=中断类型码  
        出口参数：ES=段基址，BX=偏移地址  
    * 写  
        入口参数：AH=25H，AL=中断类型码，DS=段基址，DX=偏移地址  

##### 中断响应处理
1. F寄存器入栈
2. 清除IF，TF，屏蔽新的中断  
3. 保护断点，CS：IP入栈，先CS
4. 取出中断向量，写入CS，IP
5. 执行中断服务子程序
6. 恢复断点并返回

中断服务子程序一般结构
``` x86asm
    ISR  PROC 
        保护现场

        中断处理

        恢复断点
        中断返回
    ISR  ENDP
```

##### 中断系统功能
1. 屏蔽、开放
2. 中断判优
3. 中断嵌套
4. 响应自动转入子程序，完毕自动返回断点

### 8259A芯片
CPU响应8259A中断请求过程：  
1. 当引脚IR0-IR7有中断请求时，8259中断请求寄存器相应位置1
2. 通过中断屏蔽寄存器，未被屏蔽的请求送入优先权电路
3. 优先权判优电路选出最高优先级的中断请求
4. CPU向8259发送两个负脉冲响应信号
5. 第一个脉冲，8259中断服务寄存器相应位置1,中断请求寄存器相应位清0
6. 第二个脉冲，8259将对应的中断类型码送入CPU
7. CPU取出中断向量，执行响应的子程序
8. CPU完成任务后，执行IRET之前，向8259发送中断结束命令，使中断服务寄存器ISR相应位清0

### PC机中断系统
PC机8259A管理方式：  
1. 边沿触发
2. 常规屏蔽
3. 完全嵌套，及固定优先级
4. 常规结束方式，结束须写入中断结束命令

###### 响应非屏蔽中断条件
1. NMI引脚有中断请求，无DMA请求
2. CPU当前指令执行完毕

###### 响应可屏蔽中断条件
1. INTR引脚有中断请求，NMI、DMA无请求
2. CPU当前指令执行完毕
3. 处于开中断条件

> 请求级别：`DMA` > `非屏蔽` > `可屏蔽`

##### 中断源与中断类型码对照表

| 主8259 | 中断源 | 类型码 | 从8259 | 中断源 | 类型码 |
| :----: | :---: | :---: | :---: | :---: | :---: |
| IR0    | 日时钟 | 08H   | IR0   | 实时中断 | 70H  |
| IR1    | 键盘   | 09H   | IR1   | 用户中断 | 71H改向0AH |
| IR2    | 从8259 |       | IR2   | 保留    | 72H  |
| IR3    | 辅串口 | 0BH   | IR3   | 保留    | 73H |
| IR4    | 主串口 | 0CH   | IR4   | 保留    | 74H |
| IR5    | 并口2  | 0DH   | IR5   | 协处理器 | 75H |

